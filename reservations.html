<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>My Reservations â€” Second-Hand Market</title>
<style>
  body{margin:0;font-family:system-ui,Arial;background:#f4f7f8}
  .page{max-width:900px;margin:18px auto;padding:12px}
  .card{display:flex;gap:12px;background:#fff;border-radius:12px;padding:12px;box-shadow:0 6px 16px rgba(0,0,0,.04);align-items:center}
  .thumb{width:90px;height:90px;object-fit:cover;border-radius:8px;background:#e9eef0}
  .info{flex:1}
  .btn-remove{background:#e05454;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .nav{display:flex;gap:8px;padding:10px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05);align-items:center}
</style>
</head>
<body>
  <div class="nav">
    <a href="index.html">Home</a>
    <a href="browse.html">Browse</a>
    <a href="donate.html">Donate</a>
  </div>
  <div class="page">
    <h2>My Reservations</h2>
    <div id="list"></div>
  </div>

<script>
  // protect this page: if not logged in, redirect to login
  (async function(){
    const SUPABASE_URL='https://jdxdqmggyxhdycfmvygw.supabase.co';
    const SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkeGRxbWdneXhoZHljZm12eWd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0OTAxNzYsImV4cCI6MjA3OTA2NjE3Nn0.HFwu8W_oAsY-enrdYbe-pqBYaWY6TECAruW-yINYNrE';
    // small supabase client only for session
    const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm');
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const { data } = await supabase.auth.getSession();
    const session = data?.session;
    if(!session){
      // redirect to login with redirect param
      window.location.href = 'login.html?redirect=reservations';
      return;
    }

    // if logged in, render reservations from localStorage
    function loadReservations(){
      const raw = localStorage.getItem('shm_my_reservations');
      if(!raw) return [];
      try{ return JSON.parse(raw); } catch(e){ return []; }
    }
    function render(){
      const list = document.getElementById('list');
      const arr = loadReservations();
      if(!arr.length){ list.innerHTML = '<div style="padding:18px;color:#6b7f80">No reservations yet.</div>'; return; }
      list.innerHTML = '';
      arr.forEach(r=>{
        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img'); img.className='thumb'; img.src = r.image_url || '';
        const info = document.createElement('div'); info.className='info';
        info.innerHTML = `<div style="font-weight:700">${r.name}</div><div style="color:#7f9a9a">Pickup: ${r.pickup}</div><div style="color:#9aaab0;font-size:12px">Reserved: ${new Date(r.reserved_at).toLocaleString()}</div>`;
        const btn = document.createElement('button'); btn.className='btn-remove'; btn.textContent='Remove'; btn.onclick = ()=>{ remove(r.id); };
        card.appendChild(img); card.appendChild(info); card.appendChild(btn);
        list.appendChild(card);
      });
    }
    function remove(id){
      let arr = loadReservations();
      arr = arr.filter(x=> x.id !== id);
      localStorage.setItem('shm_my_reservations', JSON.stringify(arr));
      render();
    }
    render();
  })();
</script>
</body>
</html>
